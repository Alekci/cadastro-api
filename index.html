<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css ">
    <title>Cadastro</title>
</head>

<body>
    <h3>Lista de Alunos</h3>
    <table id="tabelaAlunos" border="1">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Nascimento</th>
                <th>Telefone</th>
                <th>Endereço</th>
                <th>Excluir</th>
            </tr>
        </thead>
        <tbody>
            <!-- Linhas preenchidas pelo JavaScript -->
        </tbody>
    </table>
    <hr>
    <h3>Adicionar Novo Aluno</h3>
    Nome:
    <input type="text" id="nome" name="nome" value="">
    <br>
    Nascimento:
    <input type="date" id="nascimento" name="nascimento" value="">
    <br>
    Telefone:
    <input type="text" id="telefone" name="telefone" value="">
    <br>
    Endereço:
    <input type="text" id="endereco" name="endereco" value="">
    <br>
    <input type="hidden" name="acao" value="inserir">
    <button onclick="cadastrar()">cadastrar</button>

    <script>
        var token = "9b9038aefcd8403a8d0a3dd188e1319b";
        // Exemplo de requisição GET para listar elementoQueEstaSendoPercorrido
        fetch("https://crudcrud.com/api/" + token + "/elementoQueEstaSendoPercorrido")
            .then(response => response.json())
            .then(data => botaTabela(data))
            .catch(error => console.error("Erro no GET:", error));

        //criamos a função bota tabela que recebe os dados das elementoQueEstaSendoPercorrido
        function botaTabela(pessoas) {
            console.log(pessoas)
            //cria a variável tabela que pega o corpo da tabela pelo id
            //pega a tag tbody dentro da tabela
            //[0] pq getElementByTagName retorna um array e queremos o seu primeiro elemento
            var tabela = document.getElementById("tabelaAlunos").getElementsByTagName("tbody")[0];
            //inserir os dados na tabela da partir da variável pessoas
            pessoas.forEach(function (elementoQueEstaSendoPercorrido) {
                //criamos uma linha usando uma função do javascript
                var linha = tabela.insertRow();
                var celulaNome = linha.insertCell(0);
                var celulaNascimento = linha.insertCell(1);
                var celulaTelefone = linha.insertCell(2);
                var celulaEndereco = linha.insertCell(3);
                var celulaExcluir = linha.insertCell(4);

                celulaNome.innerHTML = elementoQueEstaSendoPercorrido.nome;
                celulaNascimento.innerHTML = elementoQueEstaSendoPercorrido.nascimento;
                celulaTelefone.innerHTML = elementoQueEstaSendoPercorrido.telefone;
                celulaEndereco.innerHTML = elementoQueEstaSendoPercorrido.endereco;
                celulaExcluir.innerHTML = '<button onclick="excluir(\'' + elementoQueEstaSendoPercorrido._id + '\')">Excluir</button>';

            });
        }

        function excluir(id) {
            var token = "9b9038aefcd8403a8d0a3dd188e1319b";
            fetch("https://crudcrud.com/api/" + token + "/elementoQueEstaSendoPercorrido/" + id, {
                method: "DELETE"
            })
                .finally(() => {
                    setTimeout(window.location.href = "index.html", 2000)
                });

        }

        function cadastrar() {
            var token = "9b9038aefcd8403a8d0a3dd188e1319b";
            // Exemplo de requisição POST para adicionar uma nova pessoa
            fetch("https://crudcrud.com/api/" + token + "/elementoQueEstaSendoPercorrido", {
                // metodo de requisição (get, post, put, delete)
                method: "POST",
                // cabeçalho da requisição(tipo de conteudo, autorizações, etc...)
                headers: {
                    "Content-Type": "application/json"
                },
                // corpo da requisição (dados que serão enviados)
                body: JSON.stringify({
                    nome: document.getElementById('nome').value,
                    nascimento: document.getElementById('nascimento').value,
                    endereco: document.getElementById('endereco').value,
                    telefone: document.getElementById('telefone').value
                })
            })
                .then(response => response.json())
                .then(data => console.log("pessoa criado:", data))
                .catch(error => console.error("Erro no POST:", error))
                .finally(() => {
                    // redirecionar para a pagina inicial
                    setTimeout(window.location.href = "index.html", 2000);

                });
        }


    </script>
</body>

</html>